<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API · ClimaCalibrate.jl</title><meta name="title" content="API · ClimaCalibrate.jl"/><meta property="og:title" content="API · ClimaCalibrate.jl"/><meta property="twitter:title" content="API · ClimaCalibrate.jl"/><meta name="description" content="Documentation for ClimaCalibrate.jl."/><meta property="og:description" content="Documentation for ClimaCalibrate.jl."/><meta property="twitter:description" content="Documentation for ClimaCalibrate.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaCalibrate.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quickstart/">Getting Started</a></li><li><a class="tocitem" href="../literate_example/">Distributed Calibration Tutorial</a></li><li><a class="tocitem" href="../backends/">Backends</a></li><li><a class="tocitem" href="../submit_scripts/">Submission Scripts</a></li><li><a class="tocitem" href="../observations/">Observations</a></li><li><a class="tocitem" href="../observation_recipe/">Observation Recipes</a></li><li><a class="tocitem" href="../ensemble_builder/">G Ensemble Builder</a></li><li><a class="tocitem" href="../emulate_sample/">Emulate and Sample</a></li><li class="is-active"><a class="tocitem" href>API</a><ul class="internal"><li><a class="tocitem" href="#Model-Interface"><span>Model Interface</span></a></li><li><a class="tocitem" href="#Worker-Interface"><span>Worker Interface</span></a></li><li><a class="tocitem" href="#Backend-Interface"><span>Backend Interface</span></a></li><li><a class="tocitem" href="#Job-Scheduler"><span>Job Scheduler</span></a></li><li><a class="tocitem" href="#EnsembleKalmanProcesses-Interface"><span>EnsembleKalmanProcesses Interface</span></a></li><li><a class="tocitem" href="#Observation-Recipe-Interface"><span>Observation Recipe Interface</span></a></li><li><a class="tocitem" href="#Ensemble-Builder-Interface"><span>Ensemble Builder Interface</span></a></li><li><a class="tocitem" href="#Checker-Interface"><span>Checker Interface</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaCalibrate.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/main/docs/src/api.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h1><h2 id="Model-Interface"><a class="docs-heading-anchor" href="#Model-Interface">Model Interface</a><a id="Model-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Interface" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="ClimaCalibrate.forward_model"><a class="docstring-binding" href="#ClimaCalibrate.forward_model"><code>ClimaCalibrate.forward_model</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">forward_model(iteration, member)</code></pre><p>Execute the forward model simulation with the given configuration.</p><p>This function must be overridden by a component&#39;s model interface and  should set things like the parameter path and other member-specific settings.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/model_interface.jl#L6-L13">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.observation_map"><a class="docstring-binding" href="#ClimaCalibrate.observation_map"><code>ClimaCalibrate.observation_map</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">observation_map(iteration)</code></pre><p>Runs the observation map for the specified iteration. This function must be implemented for each calibration experiment.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/model_interface.jl#L18-L23">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.analyze_iteration"><a class="docstring-binding" href="#ClimaCalibrate.analyze_iteration"><code>ClimaCalibrate.analyze_iteration</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">analyze_iteration(ekp, g_ensemble, prior, output_dir, iteration)</code></pre><p>After updating the ensemble and before starting the next iteration, <code>analyze_iteration</code> is evaluated.</p><p>This function is optional to implement.</p><p>For example, one may want to print information from the <code>eki</code> object or plot <code>g_ensemble</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/model_interface.jl#L28-L38">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.postprocess_g_ensemble"><a class="docstring-binding" href="#ClimaCalibrate.postprocess_g_ensemble"><code>ClimaCalibrate.postprocess_g_ensemble</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">postprocess_g_ensemble(ekp, g_ensemble, prior, output_dir, iteration)</code></pre><p>Postprocess <code>g_ensemble</code> after evaluating the observation map and before updating the ensemble.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/model_interface.jl#L45-L50">source</a></section></details></article><h2 id="Worker-Interface"><a class="docs-heading-anchor" href="#Worker-Interface">Worker Interface</a><a id="Worker-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Worker-Interface" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="ClimaCalibrate.add_workers"><a class="docstring-binding" href="#ClimaCalibrate.add_workers"><code>ClimaCalibrate.add_workers</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">add_workers(
    nworkers;
    device = :gpu,
    cluster = :auto,
    time = DEFAULT_WALLTIME,
    kwargs...
)</code></pre><p>Add <code>nworkers</code> worker processes to the current Julia session, automatically detecting and configuring for the available computing environment.</p><p><strong>Arguments</strong></p><ul><li><code>nworkers::Int</code>: The number of worker processes to add.</li><li><code>device::Symbol = :gpu</code>: The target compute device type, either <code>:gpu</code> (1 GPU, 4 CPU cores) or <code>:cpu</code> (1 CPU core).</li><li><code>cluster::Symbol = :auto</code>: The cluster management system to use. Options:<ul><li><code>:auto</code>: Auto-detect available cluster environment (SLURM, PBS, or local)</li><li><code>:slurm</code>: Force use of SLURM scheduler</li><li><code>:pbs</code>: Force use of PBS scheduler</li><li><code>:local</code>: Force use of local processing (standard <code>addprocs</code>)</li></ul></li><li><code>time::Int = DEFAULT_WALLTIME</code>: Walltime in minutes, will be formatted appropriately for the cluster system</li><li><code>kwargs</code>: Other kwargs can be passed directly through to <code>addprocs</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/workers.jl#L508-L529">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.WorkerBackend"><a class="docstring-binding" href="#ClimaCalibrate.WorkerBackend"><code>ClimaCalibrate.WorkerBackend</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">WorkerBackend</code></pre><p>Used to run calibrations on Distributed.jl&#39;s workers. For use on a Slurm cluster, see <a href="#ClimaCalibrate.SlurmManager"><code>SlurmManager</code></a>.</p><p><strong>Keyword Arguments for <code>WorkerBackend</code></strong></p><ul><li><code>failure_rate::Float64</code>: The threshold for the percentage of workers that can fail before an iteration is stopped. The default is 0.5.</li><li><code>worker_pool</code>: A worker pool created from the workers available.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L107-L118">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.SlurmManager"><a class="docstring-binding" href="#ClimaCalibrate.SlurmManager"><code>ClimaCalibrate.SlurmManager</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">SlurmManager(ntasks=get(ENV, &quot;SLURM_NTASKS&quot;, 1))</code></pre><p>The ClusterManager for Slurm clusters, taking in the number of tasks to request with <code>srun</code>.</p><p>To execute the <code>srun</code> command, run <code>addprocs(SlurmManager(ntasks))</code></p><p>Keyword arguments can be passed to <code>srun</code>: <code>addprocs(SlurmManager(ntasks), gpus_per_task=1)</code></p><p>By default the workers will inherit the running Julia environment.</p><p>To run a calibration, call <code>calibrate(WorkerBackend(), ...)</code></p><p>To run functions on a worker, call <code>remotecall(func, worker_id, args...)</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/workers.jl#L72-L86">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.PBSManager"><a class="docstring-binding" href="#ClimaCalibrate.PBSManager"><code>ClimaCalibrate.PBSManager</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">PBSManager(ntasks)</code></pre><p>The ClusterManager for PBS/Torque clusters, taking in the number of tasks to request with <code>qsub</code>.</p><p>To execute the <code>qsub</code> command, run <code>addprocs(PBSManager(ntasks))</code>.  Unlike the <a href="#ClimaCalibrate.SlurmManager"><code>SlurmManager</code></a>, this will not nest scheduled jobs, but will acquire new resources.</p><p>Keyword arguments can be passed to <code>qsub</code>: <code>addprocs(PBSManager(ntasks), nodes=2)</code></p><p>By default, the workers will inherit the running Julia environment.</p><p>To run a calibration, call <code>calibrate(WorkerBackend(), ...)</code></p><p>To run functions on a worker, call <code>remotecall(func, worker_id, args...)</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/workers.jl#L272-L287">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.set_worker_loggers"><a class="docstring-binding" href="#ClimaCalibrate.set_worker_loggers"><code>ClimaCalibrate.set_worker_loggers</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">set_worker_loggers(workers = workers())</code></pre><p>Set the global logger to a simple file logger for the given workers.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/workers.jl#L435-L439">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.map_remotecall_fetch"><a class="docstring-binding" href="#ClimaCalibrate.map_remotecall_fetch"><code>ClimaCalibrate.map_remotecall_fetch</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">map_remotecall_fetch(f::Function, args...; workers = workers())</code></pre><p>Call function <code>f</code> from each worker and wait for the results to return.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/workers.jl#L385-L389">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.foreach_remotecall_wait"><a class="docstring-binding" href="#ClimaCalibrate.foreach_remotecall_wait"><code>ClimaCalibrate.foreach_remotecall_wait</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">foreach_remotecall_wait(f::Function, args...; workers = workers())</code></pre><p>Call function <code>f</code> from each worker.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/workers.jl#L402-L406">source</a></section></details></article><h2 id="Backend-Interface"><a class="docs-heading-anchor" href="#Backend-Interface">Backend Interface</a><a id="Backend-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Backend-Interface" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="ClimaCalibrate.calibrate"><a class="docstring-binding" href="#ClimaCalibrate.calibrate"><code>ClimaCalibrate.calibrate</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">calibrate(
    ensemble_size::Int,
    n_iterations::Int,
    observations,
    noise,
    prior,
    output_dir;
    backend_kwargs::NamedTuple,
    ekp_kwargs...,
)</code></pre><p>Run a calibration using a backend constructed from <code>backend_kwargs</code> and a <code>EKP.EnsembleKalmanProcess</code> constructed from <code>ekp_kwargs</code>.</p><p>See the backend&#39;s documentation for the available keyword arguments.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L222-L238">source</a></section><section><div><pre><code class="language-julia hljs">calibrate(backend, ekp::EnsembleKalmanProcess, ensemble_size, n_iterations, prior, output_dir)
calibrate(backend, ensemble_size, n_iterations, observations, noise, prior, output_dir; ekp_kwargs...)</code></pre><p>Run a full calibration on the given backend.</p><p>If the EKP struct is not given, it will be constructed upon initialization. While EKP keyword arguments are passed through to the EKP constructor, if using many keywords it is recommended to construct the EKP object and pass it into <code>calibrate</code>.</p><p>Available Backends: <a href="#ClimaCalibrate.WorkerBackend"><code>WorkerBackend</code></a>, <a href="#ClimaCalibrate.CaltechHPCBackend"><code>CaltechHPCBackend</code></a>, <a href="#ClimaCalibrate.ClimaGPUBackend"><code>ClimaGPUBackend</code></a>, <a href="#ClimaCalibrate.DerechoBackend"><code>DerechoBackend</code></a>, <a href="#ClimaCalibrate.JuliaBackend"><code>JuliaBackend</code></a>.</p><p>Derecho, ClimaGPU, and CaltechHPC backends are designed to run on a specific high-performance computing cluster. WorkerBackend uses Distributed.jl to run the forward model on workers.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L300-L317">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.JuliaBackend"><a class="docstring-binding" href="#ClimaCalibrate.JuliaBackend"><code>ClimaCalibrate.JuliaBackend</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">JuliaBackend</code></pre><p>The simplest backend, used to run a calibration in Julia without any parallelization.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L16-L20">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.HPCBackend"><a class="docstring-binding" href="#ClimaCalibrate.HPCBackend"><code>ClimaCalibrate.HPCBackend</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">HPCBackend &lt;: AbstractBackend</code></pre><p>All concrete types of <code>HPCBackend</code> share the same keyword arguments for the constructors.</p><p><strong>Keyword Arguments for HPC backends</strong></p><ul><li><code>hpc_kwargs::Dict{Symbol, String}</code>: Dictionary of arguments passed to the job scheduler (e.g., Slurm or PBS). You may find the function <a href="#ClimaCalibrate.kwargs"><code>kwargs</code></a> helpful to construct <code>hpc_kwargs</code>.</li><li><code>verbose::Bool</code>: Enable verbose logging output. The default is <code>false</code>.</li><li><code>experiment_dir::String</code>: Directory containing the experiment&#39;s Project.toml file. The default is the current project directory.</li><li><code>model_interface::String</code>: Absolute path to the model interface file that defines how to run the forward model. The default is <code>abspath(joinpath(project_dir(), &quot;..&quot;, &quot;..&quot;, &quot;model_interface.jl&quot;))</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L23-L39">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.DerechoBackend"><a class="docstring-binding" href="#ClimaCalibrate.DerechoBackend"><code>ClimaCalibrate.DerechoBackend</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">DerechoBackend</code></pre><p>Used for NSF NCAR&#39;s <a href="https://ncar-hpc-docs.readthedocs.io/en/latest/compute-systems/derecho/">Derecho supercomputing system</a>.</p><p>See <a href="#ClimaCalibrate.HPCBackend"><code>HPCBackend</code></a> for the keyword arguments to construct a <code>DerechoBackend</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L91-L98">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.CaltechHPCBackend"><a class="docstring-binding" href="#ClimaCalibrate.CaltechHPCBackend"><code>ClimaCalibrate.CaltechHPCBackend</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">CaltechHPCBackend</code></pre><p>Used for Caltech&#39;s <a href="https://www.hpc.caltech.edu/">high-performance computing cluster</a>.</p><p>See <a href="#ClimaCalibrate.HPCBackend"><code>HPCBackend</code></a> for the keyword arguments to construct a <code>CaltechHPCBackend</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L43-L50">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ClimaGPUBackend"><a class="docstring-binding" href="#ClimaCalibrate.ClimaGPUBackend"><code>ClimaCalibrate.ClimaGPUBackend</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">ClimaGPUBackend</code></pre><p>Used for CliMA&#39;s private GPU server.</p><p>See <a href="#ClimaCalibrate.HPCBackend"><code>HPCBackend</code></a> for the keyword arguments to construct a <code>ClimaGPUBackend</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L59-L66">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.GCPBackend"><a class="docstring-binding" href="#ClimaCalibrate.GCPBackend"><code>ClimaCalibrate.GCPBackend</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">GCPBackend</code></pre><p>Used for CliMA&#39;s private GPU server.</p><p>See <a href="#ClimaCalibrate.HPCBackend"><code>HPCBackend</code></a> for the keyword arguments to construct a <code>GCPBackend</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L75-L82">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.get_backend"><a class="docstring-binding" href="#ClimaCalibrate.get_backend"><code>ClimaCalibrate.get_backend</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">get_backend()</code></pre><p>Get ideal backend for deploying forward model runs. Each backend is found via <code>gethostname()</code>. Defaults to <code>JuliaBackend</code> if none is found.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L138-L144">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.model_run"><a class="docstring-binding" href="#ClimaCalibrate.model_run"><code>ClimaCalibrate.model_run</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">model_run(backend, iter, member, output_dir, project_dir, module_load_str; exeflags)</code></pre><p>Construct and execute a command to run a single forward model on a given job scheduler.</p><p>Uses the given <code>backend</code> to run <a href="#ClimaCalibrate.slurm_model_run"><code>slurm_model_run</code></a> or <a href="#ClimaCalibrate.pbs_model_run"><code>pbs_model_run</code></a>.</p><p>Arguments:</p><ul><li><code>iter</code>: Iteration number</li><li><code>member</code>: Member number</li><li><code>output_dir</code>: Calibration experiment output directory</li><li><code>project_dir</code>: Directory containing the experiment&#39;s Project.toml</li><li><code>module_load_str</code>: Commands which load the necessary modules</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L449-L462">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.module_load_string"><a class="docstring-binding" href="#ClimaCalibrate.module_load_string"><code>ClimaCalibrate.module_load_string</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">module_load_string(backend)</code></pre><p>Return a string that loads the correct modules for a given backend when executed via bash.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/backends.jl#L164-L168">source</a></section></details></article><h2 id="Job-Scheduler"><a class="docs-heading-anchor" href="#Job-Scheduler">Job Scheduler</a><a id="Job-Scheduler-1"></a><a class="docs-heading-anchor-permalink" href="#Job-Scheduler" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="ClimaCalibrate.wait_for_jobs"><a class="docstring-binding" href="#ClimaCalibrate.wait_for_jobs"><code>ClimaCalibrate.wait_for_jobs</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">wait_for_jobs(jobids, output_dir, iter, experiment_dir, model_interface, module_load_str, model_run_func; verbose, hpc_kwargs, reruns=1)</code></pre><p>Wait for a set of jobs to complete. If a job fails, it will be rerun up to <code>reruns</code> times.</p><p>This function monitors the status of multiple jobs and handles failures by rerunning the failed jobs up to the specified number of <code>reruns</code>. It logs errors and job completion status, ensuring all jobs are completed before proceeding.</p><p>Arguments:</p><ul><li><code>jobids</code>: Vector of job IDs.</li><li><code>output_dir</code>: Directory for output.</li><li><code>iter</code>: Iteration number.</li><li><code>experiment_dir</code>: Directory for the experiment.</li><li><code>model_interface</code>: Interface to the model.</li><li><code>module_load_str</code>: Commands to load necessary modules.</li><li><code>model_run_func</code>: Function to run the model.</li><li><code>verbose</code>: Print detailed logs if true.</li><li><code>hpc_kwargs</code>: HPC job parameters.</li><li><code>reruns</code>: Number of times to rerun failed jobs.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/slurm.jl#L13-L31">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.log_member_error"><a class="docstring-binding" href="#ClimaCalibrate.log_member_error"><code>ClimaCalibrate.log_member_error</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">log_member_error(output_dir, iteration, member, verbose=false)</code></pre><p>Log a warning message when an error occurs. If verbose, includes the ensemble member&#39;s output.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/slurm.jl#L89-L93">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.kill_job"><a class="docstring-binding" href="#ClimaCalibrate.kill_job"><code>ClimaCalibrate.kill_job</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">kill_job(jobid::SlurmJobID)
kill_job(jobid::PBSJobID)</code></pre><p>End a running job, catching errors in case the job can not be ended.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/slurm.jl#L356-L361">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.job_status"><a class="docstring-binding" href="#ClimaCalibrate.job_status"><code>ClimaCalibrate.job_status</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">job_status(job_id)</code></pre><p>Parse the slurm job_id&#39;s state and return one of three status symbols: :PENDING, :RUNNING, or :COMPLETED.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/slurm.jl#L315-L319">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.kwargs"><a class="docstring-binding" href="#ClimaCalibrate.kwargs"><code>ClimaCalibrate.kwargs</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">kwargs(; kwargs...)</code></pre><p>Create a dictionary from keyword arguments.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/slurm.jl#L6-L10">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.slurm_model_run"><a class="docstring-binding" href="#ClimaCalibrate.slurm_model_run"><code>ClimaCalibrate.slurm_model_run</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">slurm_model_run(iter, member, output_dir, experiment_dir, model_interface, module_load_str; hpc_kwargs)</code></pre><p>Construct and execute a command to run a single forward model on Slurm. Helper function for <a href="#ClimaCalibrate.model_run"><code>model_run</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/slurm.jl#L241-L246">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.generate_sbatch_script"><a class="docstring-binding" href="#ClimaCalibrate.generate_sbatch_script"><code>ClimaCalibrate.generate_sbatch_script</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">generate_sbatch_script(iter, member, output_dir, experiment_dir, model_interface; module_load_str, hpc_kwargs, exeflags=&quot;&quot;)</code></pre><p>Generate a string containing an sbatch script to run the forward model. <code>hpc_kwargs</code> is turned into a series of sbatch directives using <a href="#ClimaCalibrate.generate_sbatch_directives"><code>generate_sbatch_directives</code></a>. <code>module_load_str</code> is used to load the necessary modules and can be obtained via <a href="#ClimaCalibrate.module_load_string"><code>module_load_string</code></a>. <code>exeflags</code> is a string of flags to pass to the Julia executable (defaults to empty string).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/slurm.jl#L191-L197">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.generate_sbatch_directives"><a class="docstring-binding" href="#ClimaCalibrate.generate_sbatch_directives"><code>ClimaCalibrate.generate_sbatch_directives</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">generate_sbatch_directives(hpc_kwargs)</code></pre><p>Generate Slurm sbatch directives from HPC kwargs. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/slurm.jl#L177-L181">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.submit_slurm_job"><a class="docstring-binding" href="#ClimaCalibrate.submit_slurm_job"><code>ClimaCalibrate.submit_slurm_job</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">submit_slurm_job(sbatch_filepath; env=deepcopy(ENV))</code></pre><p>Submit a job to the Slurm scheduler using sbatch, removing unwanted environment variables.</p><p>Unset variables: &quot;SLURM<em>MEM</em>PER<em>CPU&quot;, &quot;SLURM</em>MEM<em>PER</em>GPU&quot;, &quot;SLURM<em>MEM</em>PER_NODE&quot;</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/slurm.jl#L137-L143">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.pbs_model_run"><a class="docstring-binding" href="#ClimaCalibrate.pbs_model_run"><code>ClimaCalibrate.pbs_model_run</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">pbs_model_run(iter, member, output_dir, experiment_dir, model_interface, module_load_str; hpc_kwargs)</code></pre><p>Construct and execute a command to run a single forward model on PBS Pro. Helper function for <a href="#ClimaCalibrate.model_run"><code>model_run</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/pbs.jl#L77-L82">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.generate_pbs_script"><a class="docstring-binding" href="#ClimaCalibrate.generate_pbs_script"><code>ClimaCalibrate.generate_pbs_script</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>generate<em>pbs</em>script(         iter, member,         output<em>dir, experiment</em>dir, model<em>interface;         module</em>load<em>str, hpc</em>kwargs,     )</p><p>Generate a string containing a PBS script to run the forward model.</p><p>Returns:</p><ul><li><code>qsub_contents::Function</code>: A function generating the content of the PBS script based on the provided arguments.    This will run the contents of the <code>julia_script</code>, which have to be run from a file due to Derecho&#39;s <code>set_gpu_rank</code>.</li><li><code>julia_script::String</code>: The Julia script string to be executed by the PBS job. </li></ul><p>Helper function for <a href="#ClimaCalibrate.pbs_model_run"><code>pbs_model_run</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/pbs.jl#L1-L16">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.submit_pbs_job"><a class="docstring-binding" href="#ClimaCalibrate.submit_pbs_job"><code>ClimaCalibrate.submit_pbs_job</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">submit_pbs_job(sbatch_filepath; env=deepcopy(ENV))</code></pre><p>Submit a job to the PBS Pro scheduler using qsub, removing unwanted environment variables.</p><p>Unset variables: &quot;PBS<em>MEM</em>PER<em>CPU&quot;, &quot;PBS</em>MEM<em>PER</em>GPU&quot;, &quot;PBS<em>MEM</em>PER_NODE&quot;, &quot;PYTHONHOME&quot;, &quot;PYTHONPATH&quot;, &quot;PYTHONUSERBASE&quot;</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/pbs.jl#L133-L139">source</a></section></details></article><h2 id="EnsembleKalmanProcesses-Interface"><a class="docs-heading-anchor" href="#EnsembleKalmanProcesses-Interface">EnsembleKalmanProcesses Interface</a><a id="EnsembleKalmanProcesses-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#EnsembleKalmanProcesses-Interface" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="ClimaCalibrate.initialize"><a class="docstring-binding" href="#ClimaCalibrate.initialize"><code>ClimaCalibrate.initialize</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">initialize(eki::EKP.EnsembleKalmanProcess, prior, output_dir)
initialize(ensemble_size, observations, noise, prior, output_dir)</code></pre><p>Initialize a calibration, saving the initial parameter ensemble to a folder within <code>output_dir</code>.</p><p>If no EKP struct is given, construct an EKP struct and return it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L251-L258">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.save_G_ensemble"><a class="docstring-binding" href="#ClimaCalibrate.save_G_ensemble"><code>ClimaCalibrate.save_G_ensemble</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">save_G_ensemble(output_dir::AbstractString, iteration, G_ensemble)</code></pre><p>Saves the ensemble&#39;s observation map output to the correct directory based on the provided configuration. Takes an output directory, iteration number, and the ensemble output to save.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L131-L136">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.update_ensemble"><a class="docstring-binding" href="#ClimaCalibrate.update_ensemble"><code>ClimaCalibrate.update_ensemble</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">update_ensemble(output_dir::AbstractString, iteration, prior)</code></pre><p>Updates the EnsembleKalmanProcess object and saves the parameters for the next iteration.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L311-L315">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.update_ensemble!"><a class="docstring-binding" href="#ClimaCalibrate.update_ensemble!"><code>ClimaCalibrate.update_ensemble!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">update_ensemble!(ekp, G_ens, output_dir, iteration, prior)</code></pre><p>Updates an EKP object with data G_ens, saving the object and final parameters to disk.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L325-L329">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.observation_map_and_update!"><a class="docstring-binding" href="#ClimaCalibrate.observation_map_and_update!"><code>ClimaCalibrate.observation_map_and_update!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">observation_map_and_update!(ekp, output_dir, iteration, prior)</code></pre><p>Compute the observation map and update the given EKP object.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L336-L340">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.get_prior"><a class="docstring-binding" href="#ClimaCalibrate.get_prior"><code>ClimaCalibrate.get_prior</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">get_prior(param_dict::AbstractDict; names = nothing)
get_prior(prior_path::AbstractString; names = nothing)</code></pre><p>Constructs the combined prior distribution from a <code>param_dict</code> or a TOML configuration file specified by <code>prior_path</code>. If <code>names</code> is provided, only those parameters are used.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L99-L105">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.get_param_dict"><a class="docstring-binding" href="#ClimaCalibrate.get_param_dict"><code>ClimaCalibrate.get_param_dict</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">get_param_dict(distribution; names)</code></pre><p>Generates a dictionary for parameters based on the specified distribution, assumed to be of floating-point type. If <code>names</code> is not provided, the distribution&#39;s names will be used.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L118-L123">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.path_to_iteration"><a class="docstring-binding" href="#ClimaCalibrate.path_to_iteration"><code>ClimaCalibrate.path_to_iteration</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">path_to_iteration(output_dir, iteration)</code></pre><p>Return the path to the directory for a given iteration within the specified output directory.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L88-L92">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.path_to_ensemble_member"><a class="docstring-binding" href="#ClimaCalibrate.path_to_ensemble_member"><code>ClimaCalibrate.path_to_ensemble_member</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">path_to_ensemble_member(output_dir, iteration, member)</code></pre><p>Return the path to an ensemble member&#39;s directory for a given iteration and member number.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L37-L41">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.path_to_model_log"><a class="docstring-binding" href="#ClimaCalibrate.path_to_model_log"><code>ClimaCalibrate.path_to_model_log</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">path_to_model_log(output_dir, iteration, member)</code></pre><p>Return the path to an ensemble member&#39;s forward model log for a given iteration and member number.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L78-L82">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.parameter_path"><a class="docstring-binding" href="#ClimaCalibrate.parameter_path"><code>ClimaCalibrate.parameter_path</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">parameter_path(output_dir, iteration, member)</code></pre><p>Return the path to an ensemble member&#39;s parameter file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L60-L64">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.minibatcher_over_samples"><a class="docstring-binding" href="#ClimaCalibrate.minibatcher_over_samples"><code>ClimaCalibrate.minibatcher_over_samples</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">minibatcher_over_samples(n_samples, batch_size)</code></pre><p>Create a <code>FixedMinibatcher</code> that divides <code>n_samples</code> into batches of size <code>batch_size</code>.</p><p>If <code>n_samples</code> is not divisible by <code>batch_size</code>, the remaining samples will be dropped.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L374-L380">source</a></section><section><div><pre><code class="language-julia hljs">minibatcher_over_samples(samples, batch_size)</code></pre><p>Create a <code>FixedMinibatcher</code> that divides a vector of samples into batches of size <code>batch_size</code>.</p><p>If the number of samples is not divisible by <code>batch_size</code>, the remaining samples will be dropped.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L395-L401">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.observation_series_from_samples"><a class="docstring-binding" href="#ClimaCalibrate.observation_series_from_samples"><code>ClimaCalibrate.observation_series_from_samples</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">observation_series_from_samples(samples, batch_size, names = nothing)</code></pre><p>Create an <code>EKP.ObservationSeries</code> from a vector of <code>EKP.Observation</code> samples.</p><p>If the number of samples is not divisible by <code>batch_size</code>, the remaining samples will be dropped.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L406-L412">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.load_latest_ekp"><a class="docstring-binding" href="#ClimaCalibrate.load_latest_ekp"><code>ClimaCalibrate.load_latest_ekp</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">load_latest_ekp(output_dir)</code></pre><p>Return the most recent EnsembleKalmanProcess struct from the given output directory.</p><p>Returns nothing if no EKP structs are found.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/ekp_interface.jl#L21-L27">source</a></section></details></article><h2 id="Observation-Recipe-Interface"><a class="docs-heading-anchor" href="#Observation-Recipe-Interface">Observation Recipe Interface</a><a id="Observation-Recipe-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Observation-Recipe-Interface" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.AbstractCovarianceEstimator"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.AbstractCovarianceEstimator"><code>ClimaCalibrate.ObservationRecipe.AbstractCovarianceEstimator</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">abstract type AbstractCovarianceEstimator end</code></pre><p>An object that estimates the noise covariance matrix from observational data that is appropriate for a sample between <code>start_date</code> and <code>end_date</code>.</p><p><code>AbstractCovarianceEstimator</code> have to provide one function, <code>ObservationRecipe.covariance</code>.</p><p>The function has to have the signature</p><pre><code class="language-julia hljs">ObservationRecipe.covariance(
    covar_estimator::AbstractCovarianceEstimator,
    vars,
    start_date,
    end_date,
)</code></pre><p>and return a noise covariance matrix.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/observation_recipe.jl#L19-L40">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.ScalarCovariance"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.ScalarCovariance"><code>ClimaCalibrate.ObservationRecipe.ScalarCovariance</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">ScalarCovariance &lt;: AbstractCovarianceEstimator</code></pre><p>Contain the necessary information to construct the scalar covariance matrix.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/observation_recipe.jl#L43-L47">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.ScalarCovariance-Tuple{}"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.ScalarCovariance-Tuple{}"><code>ClimaCalibrate.ObservationRecipe.ScalarCovariance</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">ScalarCovariance(;
    scalar = 1.0,
    use_latitude_weights = false,
    min_cosd_lat = 0.1,
)</code></pre><p>Create a <code>ScalarCovariance</code> which specifies how the covariance matrix should be formed. When used with <code>ObservationRecipe.observation</code> or <code>ObservationRecipe.covariance</code>, return a <code>Diagonal</code> matrix.</p><p><strong>Keyword arguments</strong></p><ul><li><p><code>scalar</code>: Scalar value to multiply the identity matrix by.</p></li><li><p><code>use_latitude_weights</code>: If <code>true</code>, then latitude weighting is applied to the covariance matrix. Latitude weighting is multiplying the values along the diagonal of the covariance matrix by <code>(1 / max(cosd(lat), min_cosd_lat))</code>. See the keyword argument <code>min_cosd_lat</code> for more information.</p></li><li><p><code>min_cosd_lat</code>: Control the minimum latitude weight when <code>use_latitude_weights</code> is <code>true</code>. The value for <code>min_cosd_lat</code> must be greater than zero as values close to zero along the diagonal of the covariance matrix can lead to issues when taking the inverse of the covariance matrix.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/observation_recipe.jl#L60-L85">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.SeasonalDiagonalCovariance"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.SeasonalDiagonalCovariance"><code>ClimaCalibrate.ObservationRecipe.SeasonalDiagonalCovariance</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">SeasonalDiagonalCovariance &lt;: AbstractCovarianceEstimator</code></pre><p>Contain the necessary information to construct a diagonal covariance matrix whose entries represents seasonal covariances from <code>ClimaAnalysis.OutputVar</code>s.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/observation_recipe.jl#L103-L108">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.SeasonalDiagonalCovariance-Tuple{}"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.SeasonalDiagonalCovariance-Tuple{}"><code>ClimaCalibrate.ObservationRecipe.SeasonalDiagonalCovariance</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">SeasonalDiagonalCovariance(model_error_scale = 0.0,
                           regularization = 0.0,
                           ignore_nan = true,
                           use_latitude_weights = false,
                           min_cosd_lat = 0.1)</code></pre><p>Create a <code>SeasonalDiagonalCovariance</code> which specifies how the covariance matrix should be formed. When used with <code>ObservationRecipe.observation</code> or <code>ObservationRecipe.covariance</code>, return a <code>Diagonal</code> matrix.</p><p><strong>Keyword arguments</strong></p><ul><li><p><code>model_error_scale</code>: Noise from the model error added to the covariance matrix. This is <code>(model_error_scale * seasonal_mean).^2</code>, where <code>seasonal_mean</code> is the seasonal mean for each of the quantity for each of the season (DJF, MAM, JJA, SON).</p></li><li><p><code>regularization</code>: A diagonal matrix of the form <code>regularization * I</code> is added to the covariance matrix.</p></li><li><p><code>ignore_nan</code>: If <code>true</code>, then <code>NaN</code>s are ignored when computing the covariance matrix. Otherwise, <code>NaN</code> are included in the intermediate calculation of the covariance matrix. Note that all <code>NaN</code>s are removed in the last step of forming the covariance matrix even if <code>ignore_nan</code> is <code>false</code>.</p></li><li><p><code>use_latitude_weights</code>: If <code>true</code>, then latitude weighting is applied to the covariance matrix. Latitude weighting is multiplying the values along the diagonal of the covariance matrix by <code>(1 / max(cosd(lat), min_cosd_lat))</code>. See the keyword argument <code>min_cosd_lat</code> for more information.</p></li><li><p><code>min_cosd_lat</code>: Control the minimum latitude weight when <code>use_latitude_weights</code> is <code>true</code>. The value for <code>min_cosd_lat</code> must be greater than zero as values close to zero along the diagonal of the covariance matrix can lead to issues when taking the inverse of the covariance matrix.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/observation_recipe.jl#L131-L167">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.SVDplusDCovariance"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.SVDplusDCovariance"><code>ClimaCalibrate.ObservationRecipe.SVDplusDCovariance</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">SVDplusDCovariance &lt;: AbstractCovarianceEstimator</code></pre><p>Contain the necessary information to construct a <code>EKP.SVDplusD</code> covariance matrix from <code>ClimaAnalysis.OutputVar</code>s.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/observation_recipe.jl#L194-L199">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.SVDplusDCovariance-Tuple{Any}"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.SVDplusDCovariance-Tuple{Any}"><code>ClimaCalibrate.ObservationRecipe.SVDplusDCovariance</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">SVDplusDCovariance(sample_date_ranges;
                   model_error_scale = 0.0,
                   regularization = 0.0,
                   use_latitude_weights = false,
                   min_cosd_lat = 0.1)</code></pre><p>Create a <code>SVDplusDCovariance</code> which specifies how the covariance matrix should be formed. When used with <code>ObservationRecipe.observation</code> or <code>ObservationRecipe.covariance</code>, return a <code>EKP.SVDplusD</code> covariance matrix.</p><div class="admonition is-info" id="Recommended-sample-size-b3861203a306f692"><header class="admonition-header">Recommended sample size<a class="admonition-anchor" href="#Recommended-sample-size-b3861203a306f692" title="Permalink"></a></header><div class="admonition-body"><p>For <code>sample_date_ranges</code>, it is recommended that each sample contains data from a single year. For example, if the samples are created from time series data of seasonal averages, then each sample should contain all four seasons. Otherwise, the covariance matrix may not make sense. For example, if each sample contains two years of seasonally averaged data, then the sample mean is the seasonal mean of every other season across the years stacked vertically. For a concrete example, if the sample contain DJF for both 2010 and 2011. Then, the sample mean will be of mean of DJF 2010, 2012, and so on, and the mean of DJF 2011, 2013, and so on. As a result, if one were to use this covariance matrix with <code>model_error_scale</code>, the covariance matrix will not make sense.</p></div></div><p><strong>Positional arguments</strong></p><ul><li><code>sample_date_ranges</code>: The start and end dates of each samples. This is used to determine the sample from the time series data of the <code>OutputVar</code>s. These dates must be present in all the <code>OutputVar</code>s.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><p><code>model_error_scale</code>: Noise from the model error added to the covariance matrix. This is <code>(model_error_scale * mean(samples, dims = 2)).^2</code>, where <code>mean(samples, dims = 2)</code> is the mean of the samples.</p></li><li><p><code>regularization</code>: A diagonal matrix of the form <code>regularization * I</code> is added to the covariance matrix.</p></li><li><p><code>use_latitude_weights</code>: If <code>true</code>, then latitude weighting is applied to the covariance matrix. Latitude weighting is multiplying the columns of the matrix of samples by <code>1 / sqrt(max(cosd(lat), 0.1))</code>. See the keyword argument <code>min_cosd_lat</code> for more information.</p></li><li><p><code>min_cosd_lat</code>: Control the minimum latitude weight when <code>use_latitude_weights</code> is <code>true</code>. The value for <code>min_cosd_lat</code> must be greater than zero as values close to zero along the diagonal of the covariance matrix can lead to issues when taking the inverse of the covariance matrix.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/observation_recipe.jl#L223-L273">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.covariance"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.covariance"><code>ClimaCalibrate.ObservationRecipe.covariance</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">covariance(covar_estimator::ScalarCovariance,
           vars::Union{OutputVar, Iterable{OutputVar}},
           start_date,
           end_date)</code></pre><p>Compute the scalar covariance matrix.</p><p>Data from <code>vars</code> will not be used to compute the covariance matrix.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L6-L15">source</a></section><section><div><pre><code class="language-julia hljs">covariance(covar_estimator::SeasonalDiagonalCovariance,
           vars::Union{OutputVar, Iterable{OutputVar}},
           start_date,
           end_date)</code></pre><p>Compute the noise covariance matrix of seasonal quantities from <code>var</code> that is appropriate for a sample of seasonal quantities across time for seasons between <code>start_date</code> and <code>end_date</code>.</p><p>The diagonal is computed from the variances of the seasonal quantities.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L58-L69">source</a></section><section><div><pre><code class="language-julia hljs">covariance(covar_estimator::SVDplusDCovariance,
           vars::Union{OutputVar, Iterable{OutputVar}},
           start_date,
           end_date)</code></pre><p>Compute the <code>EKP.SVDplusD</code> covariance matrix appropriate for a sample with times between <code>start_date</code> and <code>end_date</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L162-L170">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.observation"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.observation"><code>ClimaCalibrate.ObservationRecipe.observation</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">observation(covar_estimator::AbstractCovarianceEstimator,
            vars,
            start_date,
            end_date;
            name = nothing)</code></pre><p>Return an <code>EKP.Observation</code> with a sample between the dates <code>start_date</code> and <code>end_date</code>, a covariance matrix defined by <code>covar_estimator</code>, <code>name</code> determined from the short names of <code>vars</code>, and metadata.</p><div class="admonition is-info" id="Metadata-e98f8c6220569bc9"><header class="admonition-header">Metadata<a class="admonition-anchor" href="#Metadata-e98f8c6220569bc9" title="Permalink"></a></header><div class="admonition-body"><p>Metadata in <code>EKP.observation</code> is only added with versions of EnsembleKalmanProcesses later than v2.4.2.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L278-L292">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.short_names"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.short_names"><code>ClimaCalibrate.ObservationRecipe.short_names</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">short_names(obs::EKP.Observation)</code></pre><p>Get the short names of the variables from the metadata in the <code>EKP.Observation</code>.</p><p>If the short name is not available, then <code>nothing</code> is returned instead.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L353-L359">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.get_observations_for_nth_iteration"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.get_observations_for_nth_iteration"><code>ClimaCalibrate.ObservationRecipe.get_observations_for_nth_iteration</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">get_observations_for_nth_iteration(obs_series, N)</code></pre><p>For the <code>N</code>th iteration, get the observation(s) being processed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L567-L571">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.get_metadata_for_nth_iteration"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.get_metadata_for_nth_iteration"><code>ClimaCalibrate.ObservationRecipe.get_metadata_for_nth_iteration</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">get_metadata_for_nth_iteration(obs_series, N)</code></pre><p>For the <code>N</code>th iteration, get the metadata of the observation(s) being processed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L555-L559">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.reconstruct_g_mean_final"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.reconstruct_g_mean_final"><code>ClimaCalibrate.ObservationRecipe.reconstruct_g_mean_final</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">reconstruct_g_mean_final(ekp::EKP.EnsembleKalmanProcess)</code></pre><p>Reconstruct the mean forward model evaluation at the last iteration as a vector of <code>OutputVar</code>s.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L581-L586">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.reconstruct_diag_cov"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.reconstruct_diag_cov"><code>ClimaCalibrate.ObservationRecipe.reconstruct_diag_cov</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">reconstruct_diag_cov(obs::EKP.Observation)</code></pre><p>Reconstruct the diagonal of the covariance matrix in <code>obs</code> as a vector of <code>OutputVar</code>s.</p><p>This function only supports observations that contain diagonal covariance matrices.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L618-L626">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.reconstruct_vars"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.reconstruct_vars"><code>ClimaCalibrate.ObservationRecipe.reconstruct_vars</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">reconstruct_vars(obs::EKP.Observation)</code></pre><p>Reconstruct the <code>OutputVar</code>s from the <code>samples</code> in <code>obs</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L653-L657">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.seasonally_aligned_yearly_sample_date_ranges"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.seasonally_aligned_yearly_sample_date_ranges"><code>ClimaCalibrate.ObservationRecipe.seasonally_aligned_yearly_sample_date_ranges</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">seasonally_aligned_yearly_sample_date_ranges(var::OutputVar)</code></pre><p>Generate sample dates that conform to a seasonally aligned year from <code>dates(var)</code>.</p><p>A seasonally aligned year is defined to be from December to November of the following year.</p><p>This function is useful for finding the sample dates of samples consisting of all four seasons in a single year. For example, one can use this function to find the <code>sample_date_ranges</code> when constructing <code>SVDplusDCovariance</code>.</p><div class="admonition is-info" id="All-four-seasons-in-a-year-is-not-guaranteed-f0192a72d9fc6af8"><header class="admonition-header">All four seasons in a year is not guaranteed<a class="admonition-anchor" href="#All-four-seasons-in-a-year-is-not-guaranteed-f0192a72d9fc6af8" title="Permalink"></a></header><div class="admonition-body"><p>This function does not check whether the start and end dates of each sample contain all four seasons. A sample may be missing a season, especially at the beginning or end of the time series.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L375-L392">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.ObservationRecipe.change_data_type"><a class="docstring-binding" href="#ClimaCalibrate.ObservationRecipe.change_data_type"><code>ClimaCalibrate.ObservationRecipe.change_data_type</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">ObservationRecipe.change_data_type(var::OutputVar, data_type)</code></pre><p>Return a <code>OutputVar</code> with <code>data</code> of type <code>data_type</code>.</p><p>This is useful if you want to make covariance matrix whose element type is <code>data_type</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/observation_recipe.jl#L414-L421">source</a></section></details></article><h2 id="Ensemble-Builder-Interface"><a class="docs-heading-anchor" href="#Ensemble-Builder-Interface">Ensemble Builder Interface</a><a id="Ensemble-Builder-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Ensemble-Builder-Interface" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="ClimaAnalysisExt.GEnsembleBuilder"><a class="docstring-binding" href="#ClimaAnalysisExt.GEnsembleBuilder"><code>ClimaAnalysisExt.GEnsembleBuilder</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">GEnsembleBuilder{FT &lt;: AbstractFloat}</code></pre><p>An object to help build G ensemble matrix by using the metadata stored in the <code>EKP.EnsembleKalmanProcess</code> object. Metadata must come from <code>ClimaAnalysis</code>.</p><p><code>GEnsembleBuilder</code> takes in preprocessed <code>OutputVar</code>s and automatically construct the corresponding G ensemble matrix for the current iteration of the calibration.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/ensemble_builder.jl#L21-L30">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.EnsembleBuilder.GEnsembleBuilder"><a class="docstring-binding" href="#ClimaCalibrate.EnsembleBuilder.GEnsembleBuilder"><code>ClimaCalibrate.EnsembleBuilder.GEnsembleBuilder</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">GEnsembleBuilder(ekp::EKP.EnsembleKalmanProcess{FT})
    where {FT &lt;: AbstractFloat}</code></pre><p>Construct a <code>GEnsembleBuilder</code> where the element type of the G ensemble matrix is <code>FT</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/ensemble_builder.jl#L58-L64">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.EnsembleBuilder.fill_g_ens_col!"><a class="docstring-binding" href="#ClimaCalibrate.EnsembleBuilder.fill_g_ens_col!"><code>ClimaCalibrate.EnsembleBuilder.fill_g_ens_col!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">EnsembleBuilder.fill_g_ens_col!(g_ens_builder::GEnsembleBuilder,
                                col_idx,
                                var::OutputVar;
                                checkers = (),
                                verbose = false)</code></pre><p>Fill the <code>col_idx</code>th of the G ensemble matrix from the <code>OutputVar</code> <code>var</code> and <code>ekp</code>. If it was successful, return <code>true</code>, otherwise, return <code>false</code>.</p><p>It is assumed that the times or dates of a single <code>OutputVar</code> is a superset of the times or dates of one or more metadata in the minibatch.</p><p>This function relies on the short names in the metadata. This function will not behave correctly if the short names are mislabled or not present.</p><p>Furthermore, this function assumes that all observations are generated using <code>ObservationRecipe.Observation</code> which guarantees that the metadata exists and the correct placement of metadata.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/ensemble_builder.jl#L123-L142">source</a></section><section><div><pre><code class="language-julia hljs">EnsembleBuilder.fill_g_ens_col!(g_ens_builder::GEnsembleBuilder,
                                col_idx,
                                val::AbstractFloat)</code></pre><p>Fill the <code>col_idx</code>th column of the G ensemble matrix with <code>val</code>.</p><p>This returns <code>true</code>.</p><p>This is useful if you want to completely fill a column of a G ensemble matrix with <code>NaN</code>s if a simulation crashed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/ensemble_builder.jl#L184-L195">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.EnsembleBuilder.is_complete"><a class="docstring-binding" href="#ClimaCalibrate.EnsembleBuilder.is_complete"><code>ClimaCalibrate.EnsembleBuilder.is_complete</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">EnsembleBuilder.is_complete(g_ens_builder::GEnsembleBuilder)</code></pre><p>Return <code>true</code> if all the entries of the G ensemble matrix is filled out and <code>false</code> otherwise.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/ensemble_builder.jl#L317-L322">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.EnsembleBuilder.get_g_ensemble"><a class="docstring-binding" href="#ClimaCalibrate.EnsembleBuilder.get_g_ensemble"><code>ClimaCalibrate.EnsembleBuilder.get_g_ensemble</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">EnsembleBuilder.get_g_ensemble(g_ens_builder::GEnsembleBuilder)</code></pre><p>Return the G ensemble matrix from <code>g_ens_builder</code>.</p><p>This function does not check that the G ensemble matrix is completed. See <a href="#ClimaCalibrate.EnsembleBuilder.is_complete"><code>ClimaCalibrate.EnsembleBuilder.is_complete</code></a> to check if the G ensemble matrix is completely filled out.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/ensemble_builder.jl#L327-L335">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.EnsembleBuilder.ranges_by_short_name"><a class="docstring-binding" href="#ClimaCalibrate.EnsembleBuilder.ranges_by_short_name"><code>ClimaCalibrate.EnsembleBuilder.ranges_by_short_name</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">ranges_by_short_name(g_ens_builder::GEnsembleBuilder, short_name)</code></pre><p>Return a vector of ranges for the G ensemble matrix that correspond with the short name.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/ensemble_builder.jl#L340-L345">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.EnsembleBuilder.metadata_by_short_name"><a class="docstring-binding" href="#ClimaCalibrate.EnsembleBuilder.metadata_by_short_name"><code>ClimaCalibrate.EnsembleBuilder.metadata_by_short_name</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">metadata_by_short_name(g_ens_builder::GEnsembleBuilder, short_name)</code></pre><p>Return a vector of metadata that correspond with <code>short_name</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/ensemble_builder.jl#L356-L360">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.EnsembleBuilder.missing_short_names"><a class="docstring-binding" href="#ClimaCalibrate.EnsembleBuilder.missing_short_names"><code>ClimaCalibrate.EnsembleBuilder.missing_short_names</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">missing_short_names(g_ens_builder::GEnsembleBuilder, col_idx)</code></pre><p>Return a set of the short names of the metadata that are not filled out for the <code>col_idx</code>th column of <code>g_ens_builder</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/ensemble_builder.jl#L371-L376">source</a></section></details></article><h2 id="Checker-Interface"><a class="docs-heading-anchor" href="#Checker-Interface">Checker Interface</a><a id="Checker-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Checker-Interface" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="ClimaCalibrate.Checker.AbstractChecker"><a class="docstring-binding" href="#ClimaCalibrate.Checker.AbstractChecker"><code>ClimaCalibrate.Checker.AbstractChecker</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">abstract type AbstractChecker end</code></pre><p>An object that performs validation checks between the simulation data and metadata from observational data. This is used by <code>GEnsembleBuilder</code> to validate <code>OutputVar</code>s from simulation data against the <code>Metadata</code> in the observations in the <code>EnsembleKalmanProcess</code> object.</p><p>An <code>AbstractChecker</code> must implement the <code>Checker.check</code> function.</p><p>The function must have the signature:</p><pre><code class="language-julia hljs">import ClimaCalibrate.Checker
Checker.check(::YourChecker,
              var::OutputVar,
              metadata::Metadata;
              data = nothing,
              verbose = false)</code></pre><p>and return <code>true</code> or <code>false</code>.</p><div class="admonition is-info" id="What-is-var-and-metadata?-9aa17ec46d13d88c"><header class="admonition-header">What is var and metadata?<a class="admonition-anchor" href="#What-is-var-and-metadata?-9aa17ec46d13d88c" title="Permalink"></a></header><div class="admonition-body"><p>For more information about <code>OutputVar</code> and <code>Metadata</code>, see the ClimaAnalysis <a href="https://clima.github.io/ClimaAnalysis.jl/dev/">documentation</a>.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/checkers.jl#L3-L31">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.Checker.ShortNameChecker"><a class="docstring-binding" href="#ClimaCalibrate.Checker.ShortNameChecker"><code>ClimaCalibrate.Checker.ShortNameChecker</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">struct ShortNameChecker &lt;: AbstractChecker end</code></pre><p>A struct that checks the short name between simulation data and metadata.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/checkers.jl#L34-L38">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.Checker.DimNameChecker"><a class="docstring-binding" href="#ClimaCalibrate.Checker.DimNameChecker"><code>ClimaCalibrate.Checker.DimNameChecker</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">struct DimNameChecker &lt;: AbstractChecker end</code></pre><p>A struct that checks the dimension names between simulation data and metadata.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/checkers.jl#L41-L45">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.Checker.DimUnitsChecker"><a class="docstring-binding" href="#ClimaCalibrate.Checker.DimUnitsChecker"><code>ClimaCalibrate.Checker.DimUnitsChecker</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">struct DimUnitsChecker &lt;: AbstractChecker end</code></pre><p>A struct that checks the units of the dimensions between simulation data and metadata.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/checkers.jl#L48-L53">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.Checker.UnitsChecker"><a class="docstring-binding" href="#ClimaCalibrate.Checker.UnitsChecker"><code>ClimaCalibrate.Checker.UnitsChecker</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">struct UnitsChecker &lt;: AbstractChecker end</code></pre><p>A struct that checks the units between the simulation data and metadata.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/checkers.jl#L56-L60">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.Checker.DimValuesChecker"><a class="docstring-binding" href="#ClimaCalibrate.Checker.DimValuesChecker"><code>ClimaCalibrate.Checker.DimValuesChecker</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">struct DimValuesChecker &lt;: AbstractChecker end</code></pre><p>A struct that checks the values of the dimensions between the simulation data and metadata.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/checkers.jl#L63-L68">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.Checker.SequentialIndicesChecker"><a class="docstring-binding" href="#ClimaCalibrate.Checker.SequentialIndicesChecker"><code>ClimaCalibrate.Checker.SequentialIndicesChecker</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">struct SequentialIndicesChecker &lt;: AbstractChecker end</code></pre><p>A struct that checks that the indices of the dates of the simulation data corresponding to the dates of the metadata is sequential.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/checkers.jl#L71-L76">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.Checker.SignChecker"><a class="docstring-binding" href="#ClimaCalibrate.Checker.SignChecker"><code>ClimaCalibrate.Checker.SignChecker</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">struct SignChecker{FT &lt;: AbstractFloat} &lt;: AbstractChecker</code></pre><p>A struct that checks that the proportion of positive values in the simulation data and observational data is roughly the same.</p><p>To change the default threshold of 0.05, you can pass a float to <code>SignChecker</code>.</p><pre><code class="language-julia hljs">import ClimaCalibrate
sign_checker = ClimaCalibrate.Checker.SignChecker(0.01)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/checkers.jl#L79-L90">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ClimaCalibrate.Checker.check"><a class="docstring-binding" href="#ClimaCalibrate.Checker.check"><code>ClimaCalibrate.Checker.check</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">check(checker::AbstractChecker,
      var,
      metadata;
      data = nothing,
      verbose = false)</code></pre><p>Return <code>true</code> if the check passes, <code>false</code> otherwise.</p><p>If <code>verbose=true</code>, then provides information for why a check did not succeed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/src/checkers.jl#L100-L110">source</a></section><section><div><pre><code class="language-julia hljs">Checker.check(
    ::ShortNameChecker,
    var::OutputVar,
    metadata::Metadata;
    data = nothing,
    verbose = false,
)</code></pre><p>Return <code>true</code> if <code>var</code> and <code>metadata</code> have the same short name, <code>false</code> otherwise.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/checkers.jl#L12-L23">source</a></section><section><div><pre><code class="language-julia hljs">Checker.check(
    ::DimNameChecker,
    var::OutputVar,
    metadata::Metadata;
    data = nothing,
    verbose = false,
)</code></pre><p>Return <code>true</code> if <code>var</code> and <code>metadata</code> have the same dimensions, <code>false</code> otherwise.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/checkers.jl#L42-L53">source</a></section><section><div><pre><code class="language-julia hljs">Checker.check(
    ::DimUnitsChecker,
    var::OutputVar,
    metadata::Metadata;
    data = nothing,
    verbose = false,
)</code></pre><p>Return <code>true</code> if the units of the dimensions in <code>var</code> and <code>metadata</code> are the same, <code>false</code> otherwise. This function assumes <code>var</code> and <code>metadata</code> have the same dimensions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/checkers.jl#L71-L83">source</a></section><section><div><pre><code class="language-julia hljs">Checker.check(
    ::UnitsChecker,
    var::OutputVar,
    metadata::Metadata;
    data = nothing,
    verbose = false,
)</code></pre><p>Return <code>true</code> if <code>var</code> and <code>metadata</code> have the same units, <code>false</code> otherwise.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/checkers.jl#L112-L122">source</a></section><section><div><pre><code class="language-julia hljs">Checker.check(
    ::DimValuesMatch,
    var::OutputVar,
    metadata::Metadata;
    data = nothing,
    verbose = false,
)</code></pre><p>Return <code>true</code> if the values of the dimensions in <code>var</code> and <code>metadata</code> are compatible for the purpose of filling out the G ensemble matrix, <code>false</code> otherwise.</p><p>The nontemporal dimensions are compatible if the values are approximately the same. The temporal dimensions are compatible if the temporal dimension of <code>metadata</code> is a subset of the temporal dimension of <code>var</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/checkers.jl#L142-L158">source</a></section><section><div><pre><code class="language-julia hljs">Checker.check(
    ::SequentialIndicesChecker,
    var::OutputVar,
    metadata::Metadata;
    data = nothing,
    verbose = false,
)</code></pre><p>Return <code>true</code> if the dates of <code>var</code> map to sequential indices of the dates of <code>metadata</code>, <code>false</code> otherwise.</p><div class="admonition is-info" id="Use-this-check-e9eee671ab7c5b08"><header class="admonition-header">Use this check<a class="admonition-anchor" href="#Use-this-check-e9eee671ab7c5b08" title="Permalink"></a></header><div class="admonition-body"><p>It is recommended to always enable this check when possible.</p></div></div><div class="admonition is-info" id="Why-use-this-check?-fa9cd35adfd44d08"><header class="admonition-header">Why use this check?<a class="admonition-anchor" href="#Why-use-this-check?-fa9cd35adfd44d08" title="Permalink"></a></header><div class="admonition-body"><p>This check is helpful in ensuring that the dates are matched correctly between <code>var</code> and <code>metadata</code>. For example, without this check, if the simulation data contain monthly averages and metadata track seasonal averages, then no error is thrown, because all dates in <code>metadata</code> are in all the dates in <code>var</code>.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/checkers.jl#L197-L218">source</a></section><section><div><pre><code class="language-julia hljs">Checker.check(
    ::SignChecker,
    var::OutputVar,
    metadata::Metadata;
    data,
    verbose = false,
)</code></pre><p>Return <code>true</code> if the absolute difference of the proportion of positive values in <code>var.data</code> and the proportion of positive values in <code>data</code> is less than the threshold defined in <code>SignChecker</code>, <code>false</code> otherwise.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/95e7abf151ada4a8d35f637f2df474c2fbec2792/ext/checkers.jl#L246-L258">source</a></section></details></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../emulate_sample/">« Emulate and Sample</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 31 January 2026 18:43">Saturday 31 January 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
