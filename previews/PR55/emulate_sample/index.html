<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Emulate and Sample · CalibrateAtmos.jl</title><meta name="title" content="Emulate and Sample · CalibrateAtmos.jl"/><meta property="og:title" content="Emulate and Sample · CalibrateAtmos.jl"/><meta property="twitter:title" content="Emulate and Sample · CalibrateAtmos.jl"/><meta name="description" content="Documentation for CalibrateAtmos.jl."/><meta property="og:description" content="Documentation for CalibrateAtmos.jl."/><meta property="twitter:description" content="Documentation for CalibrateAtmos.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">CalibrateAtmos.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quickstart/">Getting Started</a></li><li><a class="tocitem" href="../experiment_setup_guide/">Experiment Setup Guide</a></li><li class="is-active"><a class="tocitem" href>Emulate and Sample</a></li><li><a class="tocitem" href="../precompilation/">Precompilation</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Emulate and Sample</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Emulate and Sample</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/CalibrateAtmos.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/CalibrateAtmos.jl/blob/main/docs/src/emulate_sample.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Emulate-and-Sample"><a class="docs-heading-anchor" href="#Emulate-and-Sample">Emulate and Sample</a><a id="Emulate-and-Sample-1"></a><a class="docs-heading-anchor-permalink" href="#Emulate-and-Sample" title="Permalink"></a></h1><p>Once you have run a successful calibration, we can fit an emulator to the resulting input/output pairs.</p><p>First, import the necessary packages:</p><pre><code class="language-julia hljs">import JLD2

using CalibrateEmulateSample.Emulators
using CalibrateEmulateSample.MarkovChainMonteCarlo

import EnsembleKalmanProcesses as EKP
using EnsembleKalmanProcesses.ParameterDistributions
using EnsembleKalmanProcesses.TOMLInterface

import CalibrateAtmos as CAL</code></pre><p>Next, load in the data, EKP object, and prior distribution. These values are taken from the perfect model experiment with experiment ID <code>sphere_held_suarez_rhoe_equilmoist</code>.</p><pre><code class="language-julia hljs">asset_path = joinpath(
    pkgdir(CAL),
    &quot;docs&quot;,
    &quot;src&quot;,
    &quot;assets&quot;)

ekp = JLD2.load_object(joinpath(asset_path, &quot;emulate_example_ekiobj.jld2&quot;))
y_obs = ekp.obs_mean
y_noise_cov = ekp.obs_noise_cov
initial_params = [EKP.get_u_final(ekp)[1]]

prior_path = joinpath(asset_path, &quot;emulate_example_prior.toml&quot;)
prior = CAL.get_prior(prior_path)</code></pre><p>Get the input-output pairs which will be used to train the emulator.  The inputs are the parameter values, and the outputs are the result of the observation map.  In thise case, the outputs are the average air temperature at roughly 500 meters.</p><pre><code class="language-julia hljs">input_output_pairs = CAL.get_input_output_pairs(ekp)</code></pre><p>Next, create the Gaussian Process-based emulator and Markov chain.  The samples from the chain can be used in future predictive model runs with the same configuration. The posterior distribution can be saved to a JLD2 file using <code>save_posterior</code>. Samples can be extracted from the posterior using ClimaParams.</p><pre><code class="language-julia hljs">emulator = CAL.gp_emulator(input_output_pairs, y_noise_cov)
(; mcmc, chain) = CAL.sample(emulator, y_obs, prior, initial_params)
constrained_posterior = CAL.save_posterior(mcmc, chain; filename = &quot;samples.jld2&quot;)
display(chain)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../experiment_setup_guide/">« Experiment Setup Guide</a><a class="docs-footer-nextpage" href="../precompilation/">Precompilation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Thursday 14 March 2024 19:48">Thursday 14 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
