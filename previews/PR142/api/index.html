<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API · ClimaCalibrate.jl</title><meta name="title" content="API · ClimaCalibrate.jl"/><meta property="og:title" content="API · ClimaCalibrate.jl"/><meta property="twitter:title" content="API · ClimaCalibrate.jl"/><meta name="description" content="Documentation for ClimaCalibrate.jl."/><meta property="og:description" content="Documentation for ClimaCalibrate.jl."/><meta property="twitter:description" content="Documentation for ClimaCalibrate.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaCalibrate.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quickstart/">Getting Started</a></li><li><a class="tocitem" href="../literate_example/">Distributed Calibration Tutorial</a></li><li><a class="tocitem" href="../backends/">Backends</a></li><li><a class="tocitem" href="../emulate_sample/">Emulate and Sample</a></li><li class="is-active"><a class="tocitem" href>API</a><ul class="internal"><li><a class="tocitem" href="#Model-Interface"><span>Model Interface</span></a></li><li><a class="tocitem" href="#Worker-Interface"><span>Worker Interface</span></a></li><li><a class="tocitem" href="#Backend-Interface"><span>Backend Interface</span></a></li><li><a class="tocitem" href="#Job-Scheduler"><span>Job Scheduler</span></a></li><li><a class="tocitem" href="#EnsembleKalmanProcesses-Interface"><span>EnsembleKalmanProcesses Interface</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaCalibrate.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/main/docs/src/api.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h1><h2 id="Model-Interface"><a class="docs-heading-anchor" href="#Model-Interface">Model Interface</a><a id="Model-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Interface" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.forward_model" href="#ClimaCalibrate.forward_model"><code>ClimaCalibrate.forward_model</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">forward_model(iteration, member)</code></pre><p>Execute the forward model simulation with the given configuration.</p><p>This function must be overridden by a component&#39;s model interface and  should set things like the parameter path and other member-specific settings.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/model_interface.jl#L6-L13">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.observation_map" href="#ClimaCalibrate.observation_map"><code>ClimaCalibrate.observation_map</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">observation_map(iteration)</code></pre><p>Runs the observation map for the specified iteration. This function must be implemented for each calibration experiment.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/model_interface.jl#L18-L23">source</a></section></article><h2 id="Worker-Interface"><a class="docs-heading-anchor" href="#Worker-Interface">Worker Interface</a><a id="Worker-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Worker-Interface" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.WorkerBackend" href="#ClimaCalibrate.WorkerBackend"><code>ClimaCalibrate.WorkerBackend</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">WorkerBackend</code></pre><p>Used to run calibrations on Distributed.jl&#39;s workers. For use on a Slurm cluster, see <a href="#ClimaCalibrate.SlurmManager"><code>SlurmManager</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/backends.jl#L43-L48">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.SlurmManager" href="#ClimaCalibrate.SlurmManager"><code>ClimaCalibrate.SlurmManager</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SlurmManager(ntasks=get(ENV, &quot;SLURM_NTASKS&quot;, 1))</code></pre><p>The ClusterManager for Slurm clusters, taking in the number of tasks to request with <code>srun</code>.</p><p>To execute the <code>srun</code> command, run <code>addprocs(SlurmManager(ntasks))</code></p><p>Keyword arguments can be passed to <code>srun</code>: <code>addprocs(SlurmManager(ntasks), gpus_per_task=1)</code></p><p>By default the workers will inherit the running Julia environment.</p><p>To run a calibration, call <code>calibrate(WorkerBackend, ...)</code></p><p>To run functions on a worker, call <code>remotecall(func, worker_id, args...)</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/workers.jl#L54-L68">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.PBSManager" href="#ClimaCalibrate.PBSManager"><code>ClimaCalibrate.PBSManager</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">PBSManager(ntasks)</code></pre><p>The ClusterManager for PBS/Torque clusters, taking in the number of tasks to request with <code>qsub</code>.</p><p>To execute the <code>qsub</code> command, run <code>addprocs(PBSManager(ntasks))</code>.  Unlike the <a href="#ClimaCalibrate.SlurmManager"><code>SlurmManager</code></a>, this will not nest scheduled jobs, but will acquire new resources.</p><p>Keyword arguments can be passed to <code>qsub</code>: <code>addprocs(PBSManager(ntasks), nodes=2)</code></p><p>By default, the workers will inherit the running Julia environment.</p><p>To run a calibration, call <code>calibrate(WorkerBackend, ...)</code></p><p>To run functions on a worker, call <code>remotecall(func, worker_id, args...)</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/workers.jl#L351-L366">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.set_worker_loggers" href="#ClimaCalibrate.set_worker_loggers"><code>ClimaCalibrate.set_worker_loggers</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_worker_loggers(workers = workers())</code></pre><p>Set the global logger to a simple file logger for the given workers.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/workers.jl#L520-L524">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.map_remotecall_fetch" href="#ClimaCalibrate.map_remotecall_fetch"><code>ClimaCalibrate.map_remotecall_fetch</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">map_remotecall_fetch(f::Function, args...; workers = workers())</code></pre><p>Call function <code>f</code> from each worker and wait for the results to return.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/workers.jl#L470-L474">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.foreach_remotecall_wait" href="#ClimaCalibrate.foreach_remotecall_wait"><code>ClimaCalibrate.foreach_remotecall_wait</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">foreach_remotecall_wait(f::Function, args...; workers = workers())</code></pre><p>Call function <code>f</code> from each worker.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/workers.jl#L487-L491">source</a></section></article><h2 id="Backend-Interface"><a class="docs-heading-anchor" href="#Backend-Interface">Backend Interface</a><a id="Backend-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Backend-Interface" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.calibrate" href="#ClimaCalibrate.calibrate"><code>ClimaCalibrate.calibrate</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">calibrate(backend, ensemble_size, n_iterations, observations, noise, prior, output_dir; ekp_kwargs...)
calibrate(backend, ekp::EnsembleKalmanProcess, ensemble_size, n_iterations, prior, output_dir)
calibrate(backend, config::ExperimentConfig; ekp_kwargs...)</code></pre><p>Run a full calibration on the given backend.</p><p>If the EKP struct is not given, it will be constructed upon initialization.  The experiment configuration (ensemble size, prior, observations, etc) can be  wrapped in an ExperimentConfig or passed in as arguments to the function.</p><p>Available Backends: WorkerBackend, CaltechHPCBackend, ClimaGPUBackend, DerechoBackend, JuliaBackend</p><p>Derecho, ClimaGPU, and CaltechHPC backends are designed to run on a specific high-performance computing cluster. WorkerBackend uses Distributed.jl to run the forward model on workers.</p><p><strong>Keyword Arguments for HPC backends</strong></p><ul><li>`model_interface: Path to the model interface file.</li><li><code>hpc_kwargs</code>: Dictionary of resource arguments for HPC clusters, passed to the job scheduler.</li><li><code>verbose::Bool</code>: Enable verbose logging.</li><li>Any keyword arguments for the EnsembleKalmanProcess constructor, such as <code>scheduler</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/backends.jl#L234-L255">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.JuliaBackend" href="#ClimaCalibrate.JuliaBackend"><code>ClimaCalibrate.JuliaBackend</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">JuliaBackend</code></pre><p>The simplest backend, used to run a calibration in Julia without any parallelization.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/backends.jl#L12-L16">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.DerechoBackend" href="#ClimaCalibrate.DerechoBackend"><code>ClimaCalibrate.DerechoBackend</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DerechoBackend</code></pre><p>Used for NSF NCAR&#39;s <a href="https://ncar-hpc-docs.readthedocs.io/en/latest/compute-systems/derecho/">Derecho supercomputing system</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/backends.jl#L36-L40">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.CaltechHPCBackend" href="#ClimaCalibrate.CaltechHPCBackend"><code>ClimaCalibrate.CaltechHPCBackend</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">CaltechHPCBackend</code></pre><p>Used for Caltech&#39;s <a href="https://www.hpc.caltech.edu/">high-performance computing cluster</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/backends.jl#L22-L26">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.ClimaGPUBackend" href="#ClimaCalibrate.ClimaGPUBackend"><code>ClimaCalibrate.ClimaGPUBackend</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ClimaGPUBackend</code></pre><p>Used for CliMA&#39;s private GPU server.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/backends.jl#L29-L33">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.get_backend" href="#ClimaCalibrate.get_backend"><code>ClimaCalibrate.get_backend</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_backend()</code></pre><p>Get ideal backend for deploying forward model runs.  Each backend is found via <code>gethostname()</code>. Defaults to JuliaBackend if none is found.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/backends.jl#L51-L56">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.model_run" href="#ClimaCalibrate.model_run"><code>ClimaCalibrate.model_run</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">model_run(backend, iter, member, output_dir, experiment_dir; model_interface, verbose, hpc_kwargs)</code></pre><p>Construct and execute a command to run a single forward model on a given job scheduler.</p><p>Dispatches on <code>backend</code> to run <a href="#ClimaCalibrate.slurm_model_run"><code>slurm_model_run</code></a> or <a href="#ClimaCalibrate.pbs_model_run"><code>pbs_model_run</code></a>.</p><p>Arguments:</p><ul><li>iter: Iteration number</li><li>member: Member number</li><li>output_dir: Calibration experiment output directory</li><li>project_dir: Directory containing the experiment&#39;s Project.toml</li><li>model_interface: Model interface file</li><li>module<em>load</em>str: Commands which load the necessary modules</li><li>hpc_kwargs: Dictionary containing the resources for the job. Easily generated using <a href="#ClimaCalibrate.kwargs"><code>kwargs</code></a>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/backends.jl#L467-L482">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.module_load_string" href="#ClimaCalibrate.module_load_string"><code>ClimaCalibrate.module_load_string</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">module_load_string(backend)</code></pre><p>Return a string that loads the correct modules for a given backend when executed via bash.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/backends.jl#L74-L78">source</a></section></article><h2 id="Job-Scheduler"><a class="docs-heading-anchor" href="#Job-Scheduler">Job Scheduler</a><a id="Job-Scheduler-1"></a><a class="docs-heading-anchor-permalink" href="#Job-Scheduler" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.wait_for_jobs" href="#ClimaCalibrate.wait_for_jobs"><code>ClimaCalibrate.wait_for_jobs</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">wait_for_jobs(jobids, output_dir, iter, experiment_dir, model_interface, module_load_str, model_run_func; verbose, hpc_kwargs, reruns=1)</code></pre><p>Wait for a set of jobs to complete. If a job fails, it will be rerun up to <code>reruns</code> times.</p><p>This function monitors the status of multiple jobs and handles failures by rerunning the failed jobs up to the specified number of <code>reruns</code>. It logs errors and job completion status, ensuring all jobs are completed before proceeding.</p><p>Arguments:</p><ul><li><code>jobids</code>: Vector of job IDs.</li><li><code>output_dir</code>: Directory for output.</li><li><code>iter</code>: Iteration number.</li><li><code>experiment_dir</code>: Directory for the experiment.</li><li><code>model_interface</code>: Interface to the model.</li><li><code>module_load_str</code>: Commands to load necessary modules.</li><li><code>model_run_func</code>: Function to run the model.</li><li><code>verbose</code>: Print detailed logs if true.</li><li><code>hpc_kwargs</code>: HPC job parameters.</li><li><code>reruns</code>: Number of times to rerun failed jobs.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/slurm.jl#L13-L31">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.log_member_error" href="#ClimaCalibrate.log_member_error"><code>ClimaCalibrate.log_member_error</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">log_member_error(output_dir, iteration, member, verbose=false)</code></pre><p>Log a warning message when an error occurs. If verbose, includes the ensemble member&#39;s output.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/slurm.jl#L89-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.kill_job" href="#ClimaCalibrate.kill_job"><code>ClimaCalibrate.kill_job</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">kill_job(jobid::SlurmJobID)
kill_job(jobid::PBSJobID)</code></pre><p>End a running job, catching errors in case the job can not be ended.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/slurm.jl#L349-L354">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.job_status" href="#ClimaCalibrate.job_status"><code>ClimaCalibrate.job_status</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">job_status(job_id)</code></pre><p>Parse the slurm job_id&#39;s state and return one of three status symbols: :PENDING, :RUNNING, or :COMPLETED.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/slurm.jl#L308-L312">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.kwargs" href="#ClimaCalibrate.kwargs"><code>ClimaCalibrate.kwargs</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">kwargs(; kwargs...)</code></pre><p>Create a dictionary from keyword arguments.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/slurm.jl#L6-L10">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.slurm_model_run" href="#ClimaCalibrate.slurm_model_run"><code>ClimaCalibrate.slurm_model_run</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">slurm_model_run(iter, member, output_dir, experiment_dir, model_interface, module_load_str; hpc_kwargs)</code></pre><p>Construct and execute a command to run a single forward model on Slurm. Helper function for <a href="#ClimaCalibrate.model_run"><code>model_run</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/slurm.jl#L236-L241">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.generate_sbatch_script" href="#ClimaCalibrate.generate_sbatch_script"><code>ClimaCalibrate.generate_sbatch_script</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">generate_sbatch_script(iter, member, output_dir, experiment_dir, model_interface; module_load_str, hpc_kwargs)</code></pre><p>Generate a string containing an sbatch script to run the forward model.</p><p><code>hpc_kwargs</code> is turned into a series of sbatch directives using <a href="#ClimaCalibrate.generate_sbatch_directives"><code>generate_sbatch_directives</code></a>. <code>module_load_str</code> is used to load the necessary modules and can be obtained via <a href="#ClimaCalibrate.module_load_string"><code>module_load_string</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/slurm.jl#L192-L199">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.generate_sbatch_directives" href="#ClimaCalibrate.generate_sbatch_directives"><code>ClimaCalibrate.generate_sbatch_directives</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">generate_sbatch_directives(hpc_kwargs)</code></pre><p>Generate Slurm sbatch directives from HPC kwargs. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/slurm.jl#L177-L181">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.submit_slurm_job" href="#ClimaCalibrate.submit_slurm_job"><code>ClimaCalibrate.submit_slurm_job</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">submit_slurm_job(sbatch_filepath; env=deepcopy(ENV))</code></pre><p>Submit a job to the Slurm scheduler using sbatch, removing unwanted environment variables.</p><p>Unset variables: &quot;SLURM<em>MEM</em>PER<em>CPU&quot;, &quot;SLURM</em>MEM<em>PER</em>GPU&quot;, &quot;SLURM<em>MEM</em>PER_NODE&quot;</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/slurm.jl#L137-L143">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.pbs_model_run" href="#ClimaCalibrate.pbs_model_run"><code>ClimaCalibrate.pbs_model_run</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">pbs_model_run(iter, member, output_dir, experiment_dir, model_interface, module_load_str; hpc_kwargs)</code></pre><p>Construct and execute a command to run a single forward model on PBS Pro. Helper function for <a href="#ClimaCalibrate.model_run"><code>model_run</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/pbs.jl#L75-L80">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.generate_pbs_script" href="#ClimaCalibrate.generate_pbs_script"><code>ClimaCalibrate.generate_pbs_script</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>generate<em>pbs</em>script(         iter, member,         output<em>dir, experiment</em>dir, model<em>interface;         module</em>load<em>str, hpc</em>kwargs,     )</p><p>Generate a string containing a PBS script to run the forward model.</p><p>Returns:</p><ul><li><code>qsub_contents::Function</code>: A function generating the content of the PBS script based on the provided arguments.    This will run the contents of the <code>julia_script</code>, which have to be run from a file due to Derecho&#39;s <code>set_gpu_rank</code>.</li><li><code>julia_script::String</code>: The Julia script string to be executed by the PBS job. </li></ul><p>Helper function for <a href="#ClimaCalibrate.pbs_model_run"><code>pbs_model_run</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/pbs.jl#L1-L16">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.submit_pbs_job" href="#ClimaCalibrate.submit_pbs_job"><code>ClimaCalibrate.submit_pbs_job</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">submit_pbs_job(sbatch_filepath; env=deepcopy(ENV))</code></pre><p>Submit a job to the PBS Pro scheduler using qsub, removing unwanted environment variables.</p><p>Unset variables: &quot;PBS<em>MEM</em>PER<em>CPU&quot;, &quot;PBS</em>MEM<em>PER</em>GPU&quot;, &quot;PBS<em>MEM</em>PER_NODE&quot;</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/pbs.jl#L129-L135">source</a></section></article><h2 id="EnsembleKalmanProcesses-Interface"><a class="docs-heading-anchor" href="#EnsembleKalmanProcesses-Interface">EnsembleKalmanProcesses Interface</a><a id="EnsembleKalmanProcesses-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#EnsembleKalmanProcesses-Interface" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.initialize" href="#ClimaCalibrate.initialize"><code>ClimaCalibrate.initialize</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">initialize(ensemble_size, observations, noise, prior, output_dir)
initialize(eki::EKP.EnsembleKalmanProcess, prior, output_dir)
initialize(config)</code></pre><p>Initialize a calibration, saving the initial parameter ensemble to a folder within <code>output_dir</code>.</p><p>If no EKP struct is given, construct an EKP struct and return it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/ekp_interface.jl#L273-L281">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.save_G_ensemble" href="#ClimaCalibrate.save_G_ensemble"><code>ClimaCalibrate.save_G_ensemble</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">save_G_ensemble(config::ExperimentConfig, iteration, G_ensemble)
save_G_ensemble(output_dir::AbstractString, iteration, G_ensemble)</code></pre><p>Saves the ensemble&#39;s observation map output to the correct directory based on the provided configuration. Takes an output directory, either extracted from an ExperimentConfig or passed directly.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/ekp_interface.jl#L173-L179">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.update_ensemble" href="#ClimaCalibrate.update_ensemble"><code>ClimaCalibrate.update_ensemble</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">update_ensemble(output_dir::AbstractString, iteration, prior)
update_ensemble(config::ExperimentConfig, iteration)
update_ensemble(config_file::AbstractString, iteration)</code></pre><p>Updates the EnsembleKalmanProcess object and saves the parameters for the next iteration.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/ekp_interface.jl#L339-L345">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.ExperimentConfig" href="#ClimaCalibrate.ExperimentConfig"><code>ClimaCalibrate.ExperimentConfig</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ExperimentConfig(
    n_iterations::Integer,
    ensemble_size::Integer,
    observations,
    noise,
    prior::ParameterDistribution,
    output_dir,
)
ExperimentConfig(filepath::AbstractString; kwargs...)</code></pre><p>Construct an ExperimentConfig from a given YAML file or directory containing &#39;experiment_config.yml&#39;.</p><p>ExperimentConfig holds the configuration for a calibration experiment. This can be constructed from a YAML configuration file or directly using individual parameters.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/ekp_interface.jl#L13-L28">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.get_prior" href="#ClimaCalibrate.get_prior"><code>ClimaCalibrate.get_prior</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_prior(param_dict::AbstractDict; names = nothing)
get_prior(prior_path::AbstractString; names = nothing)</code></pre><p>Constructs the combined prior distribution from a <code>param_dict</code> or a TOML configuration file specified by <code>prior_path</code>. If <code>names</code> is provided, only those parameters are used.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/ekp_interface.jl#L141-L147">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.get_param_dict" href="#ClimaCalibrate.get_param_dict"><code>ClimaCalibrate.get_param_dict</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_param_dict(distribution; names)</code></pre><p>Generates a dictionary for parameters based on the specified distribution, assumed to be of floating-point type. If <code>names</code> is not provided, the distribution&#39;s names will be used.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/ekp_interface.jl#L160-L165">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.path_to_iteration" href="#ClimaCalibrate.path_to_iteration"><code>ClimaCalibrate.path_to_iteration</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">path_to_iteration(output_dir, iteration)</code></pre><p>Return the path to the directory for a given iteration within the specified output directory.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/ekp_interface.jl#L130-L134">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.path_to_ensemble_member" href="#ClimaCalibrate.path_to_ensemble_member"><code>ClimaCalibrate.path_to_ensemble_member</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">path_to_ensemble_member(output_dir, iteration, member)</code></pre><p>Return the path to an ensemble member&#39;s directory for a given iteration and member number.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/ekp_interface.jl#L91-L95">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.path_to_model_log" href="#ClimaCalibrate.path_to_model_log"><code>ClimaCalibrate.path_to_model_log</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">path_to_model_log(output_dir, iteration, member)</code></pre><p>Return the path to an ensemble member&#39;s forward model log for a given iteration and member number.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/ekp_interface.jl#L120-L124">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaCalibrate.parameter_path" href="#ClimaCalibrate.parameter_path"><code>ClimaCalibrate.parameter_path</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">parameter_path(output_dir, iteration, member)</code></pre><p>Return the path to an ensemble member&#39;s parameter file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCalibrate.jl/blob/5ffbf68f7d7b017584229e4550a703c015ae8ab0/src/ekp_interface.jl#L102-L106">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../emulate_sample/">« Emulate and Sample</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Tuesday 18 February 2025 20:36">Tuesday 18 February 2025</span>. Using Julia version 1.10.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
